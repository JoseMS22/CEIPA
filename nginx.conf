# ==========================================
# NGINX reverse proxy para CEIPA Risk
# Frontend: Next.js (puerto 3000)
# Backend: FastAPI (puerto 8000)
# ==========================================

events {}

http {
    include       mime.types;
    default_type  application/octet-stream;

    # Compresión gzip para mejorar performance
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
    gzip_min_length 1024;

    # Ajusta tamaños si subís Excel grandes
    client_max_body_size 20M;

    # ---------------------------------------
    # SERVIDOR PRINCIPAL
    # ---------------------------------------
    server {
        listen 80;
        server_name risk.jamscode.work;   # o tu dominio real ejemplo: riesgo.ceipa.com

        # ---------
        # FRONTEND
        # ---------
        location / {
            proxy_pass http://host.docker.internal:3000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_cache_bypass $http_upgrade;
        }

        # ---------
        # BACKEND API
        # (opcional si usas /api como prefijo)
        # ---------
        location /api/ {
            proxy_pass http://host.docker.internal:8000/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}
